# 游戏空间功能说明

## 功能概述

游戏空间是一个互动游戏合集，包含多种寓教于乐的游戏。

## 目录结构

### 后端数据存储
```
fileDB/games/
├── games.json           # 游戏列表配置
├── gameStats.json       # 游戏统计数据
├── gameSaves.json       # 游戏存档数据
├── 2048_styles.json     # 2048样式组配置
├── dance_templates.json # 跳舞模板列表
└── README.md
```

### 前端游戏代码
```
client/src/games/
├── types.ts             # 通用类型定义
├── api.ts               # 通用API调用
├── game2048/            # 2048游戏
│   ├── index.tsx        # 游戏主组件
│   ├── Game2048.ts      # 游戏逻辑
│   └── styles.ts        # 样式组管理
├── followDance/         # 跟随跳舞
│   ├── index.tsx        # 游戏主组件
│   └── types.ts         # 类型定义
└── mathBattle/          # 数字大战
    ├── index.tsx        # 游戏主组件
    └── types.ts         # 类型定义
```

### 上传文件存储
```
uploadFiles/gameFiles/
├── 2048/                # 2048游戏资源
├── followDance/         # 跳舞视频和封面
└── mathBattle/          # 数字大战资源
```

## 游戏列表

### 1. 2048
经典数字合成游戏

**功能特性：**
- 支持 4x4 到 8x8 多种格子大小
- 支持自定义方块样式组
- 游戏存档功能
- 达到2048后可继续游戏（无限模式）
- 键盘（方向键/WASD）和触摸滑动操作

**数据统计：**
- 游戏次数
- 累计游戏时间
- 今日游戏时间
- 历史最高分
- 今日最高分

### 2. 跟随跳舞
跟着视频学跳舞

**功能特性：**
- 支持上传跳舞视频模板
- 可设置模板封面图
- 摄像头实时显示
- 左右分屏对比（我的舞姿 vs 跟我学）
- 背景特效（可开关）

**数据统计：**
- 播放时间统计
- 游戏次数记录

### 3. 数字大战
数学运算闯关游戏

**功能特性：**
- 支持加减乘除四种运算
- 每种运算可独立开关和设置数值范围
- 可调整游戏速度
- 三条命，答错扣血
- 炫酷的游戏界面和动画

**数据统计：**
- 闯关分数
- 游戏时长

## API接口

### 通用接口

| 接口                       | 方法   | 说明             |
| -------------------------- | ------ | ---------------- |
| `/api/games/list`          | GET    | 获取游戏列表     |
| `/api/games/stats`         | GET    | 获取所有游戏统计 |
| `/api/games/stats/:gameId` | GET    | 获取单个游戏统计 |
| `/api/games/report`        | POST   | 上报游戏数据     |
| `/api/games/save`          | POST   | 保存游戏存档     |
| `/api/games/save/:gameId`  | GET    | 获取游戏存档     |
| `/api/games/save/:gameId`  | DELETE | 删除游戏存档     |

### 2048专用接口

| 接口                              | 方法   | 说明           |
| --------------------------------- | ------ | -------------- |
| `/api/games/2048/styles`          | GET    | 获取样式组列表 |
| `/api/games/2048/styles`          | POST   | 保存样式组     |
| `/api/games/2048/styles/:styleId` | DELETE | 删除样式组     |

### 跟随跳舞专用接口

| 接口                                           | 方法   | 说明                                |
| ---------------------------------------------- | ------ | ----------------------------------- |
| `/api/games/followDance/templates`             | GET    | 获取跳舞模板列表                    |
| `/api/games/followDance/templates`             | POST   | 上传跳舞模板（multipart/form-data） |
| `/api/games/followDance/templates/:templateId` | DELETE | 删除跳舞模板                        |

## 数据结构

### 游戏统计 (GameStats)
```typescript
interface GameStats {
    gameCount: number;        // 游戏次数
    totalPlayTime: number;    // 累计游戏时间（秒）
    todayPlayTime: number;    // 今日游戏时间（秒）
    highestScore: number;     // 历史最高分
    todayHighestScore: number;// 今日最高分
    lastPlayDate: string;     // 最后游戏日期
    todayDate: string;        // 今日日期（用于重置）
}
```

### 游戏存档 (GameSave)
```typescript
interface GameSave {
    saveTime: string;         // 存档时间
    gameData: any;            // 具体游戏数据
}
```

## 开发指南

### 添加新游戏

1. 在 `client/src/games/` 下创建游戏目录
2. 实现 `index.tsx` 作为游戏主组件
3. 在 `App.tsx` 中添加路由
4. 在 `fileDB/games/games.json` 中添加游戏配置
5. 游戏结束时调用 `/api/games/report` 上报数据

### 游戏开发规范

1. 游戏开始时记录开始时间
2. 游戏结束时计算游戏时长并上报
3. 支持存档的游戏需实现存档和读档功能
4. 使用统一的返回按钮和页面布局风格
